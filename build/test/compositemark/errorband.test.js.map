{"version":3,"file":"errorband.test.js","sourceRoot":"","sources":["../../../test/compositemark/errorband.test.ts"],"names":[],"mappings":"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","sourcesContent":["/* tslint:disable:quotemark */\nimport {assert} from 'chai';\n\nimport * as log from '../../src/log';\nimport {isMarkDef} from '../../src/mark';\nimport {isLayerSpec, isUnitSpec, normalize} from '../../src/spec';\nimport {every, some} from '../../src/util';\nimport {defaultConfig} from '.././../src/config';\n\ndescribe('normalizeErrorBand', () => {\n  it('should produce correct layered specs for mean point and vertical error band', () => {\n    assert.deepEqual(\n      normalize(\n        {\n          data: {\n            url: 'data/population.json'\n          },\n          mark: 'errorband',\n          encoding: {\n            x: {\n              field: 'age',\n              type: 'ordinal'\n            },\n            y: {\n              field: 'people',\n              type: 'quantitative'\n            }\n          }\n        },\n        defaultConfig\n      ),\n      {\n        data: {\n          url: 'data/population.json'\n        },\n        transform: [\n          {\n            aggregate: [\n              {\n                op: 'stderr',\n                field: 'people',\n                as: 'extent_people'\n              },\n              {\n                op: 'mean',\n                field: 'people',\n                as: 'center_people'\n              }\n            ],\n            groupby: ['age']\n          },\n          {\n            calculate: 'datum.center_people + datum.extent_people',\n            as: 'upper_people'\n          },\n          {\n            calculate: 'datum.center_people - datum.extent_people',\n            as: 'lower_people'\n          }\n        ],\n        layer: [\n          {\n            mark: {\n              opacity: 0.3,\n              type: 'area',\n              style: 'errorband-band'\n            },\n            encoding: {\n              y: {\n                field: 'lower_people',\n                type: 'quantitative',\n                title: 'people'\n              },\n              y2: {\n                field: 'upper_people',\n                type: 'quantitative'\n              },\n              x: {\n                field: 'age',\n                type: 'ordinal',\n                title: 'age'\n              }\n            }\n          }\n        ]\n      }\n    );\n  });\n\n  it('should produce correct layered specs with rect + rule, instead of area + line, in 1D error band', () => {\n    const outputSpec = normalize(\n      {\n        data: {url: 'data/population.json'},\n        mark: {type: 'errorband', borders: true},\n        encoding: {y: {field: 'people', type: 'quantitative'}}\n      },\n      defaultConfig\n    );\n\n    const layer = isLayerSpec(outputSpec) && outputSpec.layer;\n    if (layer) {\n      assert.isTrue(\n        some(layer, unitSpec => {\n          return isUnitSpec(unitSpec) && isMarkDef(unitSpec.mark) && unitSpec.mark.type === 'rect';\n        })\n      );\n      assert.isTrue(\n        some(layer, unitSpec => {\n          return isUnitSpec(unitSpec) && isMarkDef(unitSpec.mark) && unitSpec.mark.type === 'rule';\n        })\n      );\n    } else {\n      assert.fail(!layer, false, 'layer should be a part of the spec');\n    }\n  });\n\n  it('should produce correct layered specs with area + line, in 2D error band', () => {\n    const outputSpec = normalize(\n      {\n        data: {url: 'data/population.json'},\n        mark: {type: 'errorband', borders: true},\n        encoding: {\n          y: {field: 'people', type: 'quantitative'},\n          x: {field: 'age', type: 'ordinal'}\n        }\n      },\n      defaultConfig\n    );\n\n    const layer = isLayerSpec(outputSpec) && outputSpec.layer;\n    if (layer) {\n      assert.isTrue(\n        some(layer, unitSpec => {\n          return isUnitSpec(unitSpec) && isMarkDef(unitSpec.mark) && unitSpec.mark.type === 'area';\n        })\n      );\n      assert.isTrue(\n        some(layer, unitSpec => {\n          return isUnitSpec(unitSpec) && isMarkDef(unitSpec.mark) && unitSpec.mark.type === 'line';\n        })\n      );\n    } else {\n      assert.fail(!layer, false, 'layer should be a part of the spec');\n    }\n  });\n\n  it('should produce correct layered specs with interpolation in 2D error band', () => {\n    const outputSpec = normalize(\n      {\n        data: {url: 'data/population.json'},\n        mark: {type: 'errorband', interpolate: 'monotone'},\n        encoding: {\n          y: {field: 'people', type: 'quantitative'},\n          x: {field: 'age', type: 'ordinal'}\n        }\n      },\n      defaultConfig\n    );\n\n    const layer = isLayerSpec(outputSpec) && outputSpec.layer;\n    if (layer) {\n      assert.isTrue(\n        every(layer, unitSpec => {\n          return isUnitSpec(unitSpec) && isMarkDef(unitSpec.mark) && unitSpec.mark.interpolate === 'monotone';\n        })\n      );\n    } else {\n      assert.fail(!layer, false, 'layer should be a part of the spec');\n    }\n  });\n\n  it('should produce correct layered specs with out interpolation in 1D error band', () => {\n    const outputSpec = normalize(\n      {\n        data: {url: 'data/population.json'},\n        mark: {type: 'errorband', interpolate: 'bundle', tension: 1},\n        encoding: {\n          y: {field: 'people', type: 'quantitative'}\n        }\n      },\n      defaultConfig\n    );\n\n    const layer = isLayerSpec(outputSpec) && outputSpec.layer;\n    if (layer) {\n      assert.isTrue(\n        every(layer, unitSpec => {\n          return isUnitSpec(unitSpec) && isMarkDef(unitSpec.mark) && !unitSpec.mark.interpolate;\n        })\n      );\n    } else {\n      assert.fail(!layer, false, 'layer should be a part of the spec');\n    }\n  });\n\n  it(\n    'should produce a warning 1D error band has interpolate property',\n    log.wrap(localLogger => {\n      normalize(\n        {\n          data: {url: 'data/population.json'},\n          mark: {type: 'errorband', interpolate: 'monotone'},\n          encoding: {\n            y: {field: 'people', type: 'quantitative'}\n          }\n        },\n        defaultConfig\n      );\n\n      assert.equal(localLogger.warns[0], log.message.errorBand1DNotSupport('interpolate'));\n    })\n  );\n\n  it(\n    'should produce a warning 1D error band has tension property',\n    log.wrap(localLogger => {\n      normalize(\n        {\n          data: {url: 'data/population.json'},\n          mark: {type: 'errorband', tension: 1},\n          encoding: {\n            y: {field: 'people', type: 'quantitative'}\n          }\n        },\n        defaultConfig\n      );\n\n      assert.equal(localLogger.warns[0], log.message.errorBand1DNotSupport('tension'));\n    })\n  );\n});\n"]}