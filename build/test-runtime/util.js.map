{"version":3,"file":"util.js","sourceRoot":"","sources":["../../test-runtime/util.ts"],"names":[],"mappings":";AAAA,OAAO,KAAK,EAAE,MAAM,IAAI,CAAC;AACzB,OAAO,EAAC,IAAI,IAAI,MAAM,EAAC,MAAM,QAAQ,CAAC;AAEtC,OAAO,EAAC,WAAW,EAAC,MAAM,WAAW,CAAC;AAItC,MAAM,QAAQ,GAAG,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC;AAC/C,MAAM,MAAM,GAAG,wBAAwB,CAAC;AAGxC,MAAM,CAAC,MAAM,cAAc,GAAoB,CAAC,QAAQ,EAAE,OAAO,EAAE,UAAU,CAAC,CAAC;AAC/E,MAAM,CAAC,MAAM,cAAc,GAAkB,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;AACjE,MAAM,CAAC,MAAM,WAAW,GAA0B,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC;AAEzE,MAAM,CAAC,MAAM,KAAK,GAAG,OAAO,CAAC;AAC7B,MAAM,CAAC,MAAM,OAAO,GAAG,SAAS,CAAC;AAEjC,MAAM,CAAC,MAAM,MAAM,GAAG;IACpB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAC;IACnB,EAAC,CAAC,EAAE,CAAC,EAAE,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","sourcesContent":["import * as fs from 'fs';\nimport {sync as mkdirp} from 'mkdirp';\nimport {Page} from 'puppeteer';\nimport {stringValue} from 'vega-util';\nimport {SelectionResolution, SelectionType} from '../src/selection';\nimport {NormalizedLayerSpec, NormalizedUnitSpec, TopLevelSpec} from '../src/spec';\n\nconst generate = process.env.VL_GENERATE_TESTS;\nconst output = 'test-runtime/resources';\n\nexport type ComposeType = 'unit' | 'repeat' | 'facet';\nexport const selectionTypes: SelectionType[] = ['single', 'multi', 'interval'];\nexport const compositeTypes: ComposeType[] = ['repeat', 'facet'];\nexport const resolutions: SelectionResolution[] = ['union', 'intersect'];\n\nexport const bound = 'bound';\nexport const unbound = 'unbound';\n\nexport const tuples = [\n  {a: 0, b: 28, c: 0},\n  {a: 0, b: 55, c: 1},\n  {a: 0, b: 23, c: 2},\n  {a: 1, b: 43, c: 0},\n  {a: 1, b: 91, c: 1},\n  {a: 1, b: 54, c: 2},\n  {a: 2, b: 81, c: 0},\n  {a: 2, b: 53, c: 1},\n  {a: 2, b: 76, c: 2},\n  {a: 3, b: 19, c: 0},\n  {a: 3, b: 87, c: 1},\n  {a: 3, b: 12, c: 2},\n  {a: 4, b: 52, c: 0},\n  {a: 4, b: 48, c: 1},\n  {a: 4, b: 35, c: 2},\n  {a: 5, b: 24, c: 0},\n  {a: 5, b: 49, c: 1},\n  {a: 5, b: 48, c: 2},\n  {a: 6, b: 87, c: 0},\n  {a: 6, b: 66, c: 1},\n  {a: 6, b: 23, c: 2},\n  {a: 7, b: 17, c: 0},\n  {a: 7, b: 27, c: 1},\n  {a: 7, b: 39, c: 2},\n  {a: 8, b: 68, c: 0},\n  {a: 8, b: 16, c: 1},\n  {a: 8, b: 67, c: 2},\n  {a: 9, b: 49, c: 0},\n  {a: 9, b: 15, c: 1},\n  {a: 9, b: 48, c: 2}\n];\n\nconst UNIT_NAMES = {\n  repeat: ['child__repeat_row_d', 'child__repeat_row_e', 'child__repeat_row_f'],\n  facet: ['child__facet_row_0', 'child__facet_row_1', 'child__facet_row_2']\n};\n\nexport const hits = {\n  discrete: {\n    qq: [8, 19],\n    qq_clear: [5, 16],\n\n    bins: [4, 29],\n    bins_clear: [18, 7],\n\n    repeat: [5, 10, 17],\n    repeat_clear: [13, 14, 2],\n\n    facet: [2, 6, 9],\n    facet_clear: [3, 4, 8]\n  },\n\n  interval: {\n    drag: [[5, 14], [18, 26]],\n    drag_clear: [[5], [16]],\n    translate: [[6, 16], [24, 8]],\n\n    bins: [[4, 8], [2, 7]],\n    bins_clear: [[5], [9]],\n    bins_translate: [[5, 7], [1, 8]],\n\n    repeat: [[8, 29], [11, 26], [7, 21]],\n    repeat_clear: [[8], [11], [17]],\n\n    facet: [[1, 9], [2, 8], [4, 10]],\n    facet_clear: [[3], [5], [7]]\n  }\n};\n\nfunction base(iter: number, sel: any, opts: any = {}): NormalizedUnitSpec | NormalizedLayerSpec {\n  const data = {values: opts.values || tuples};\n  const x = {field: 'a', type: 'quantitative', ...opts.x};\n  const y = {field: 'b', type: 'quantitative', ...opts.y};\n  const color = {field: 'c', type: 'nominal', ...opts.color};\n  const size = {value: 100, ...opts.size};\n  const selection = {sel};\n  const mark = 'circle';\n\n  if (iter % 2 === 0) {\n    return {\n      data,\n      selection,\n      mark,\n      encoding: {\n        x,\n        y,\n        size,\n        color: {\n          condition: {selection: 'sel', ...color},\n          value: 'grey'\n        }\n      }\n    };\n  } else {\n    return {\n      data,\n      layer: [\n        {\n          selection,\n          mark,\n          encoding: {\n            x,\n            y,\n            size,\n            color,\n            opacity: {value: 0.25}\n          }\n        },\n        {\n          transform: [{filter: {selection: 'sel'}}],\n          mark,\n          encoding: {x, y, size, color}\n        }\n      ]\n    };\n  }\n}\n\nexport function spec(compose: ComposeType, iter: number, sel: any, opts: any = {}): TopLevelSpec {\n  const {data, ...specification} = base(iter, sel, opts);\n  const resolve = opts.resolve;\n  const config = {scale: {rangeStep: 21}}; // A lot of magic number in this file uses the old rangeStep = 21\n  switch (compose) {\n    case 'unit':\n      return {data, ...specification, config};\n    case 'facet':\n      return {\n        data,\n        facet: {row: {field: 'c', type: 'nominal'}},\n        spec: specification,\n        resolve,\n        config\n      };\n    case 'repeat':\n      return {\n        data,\n        repeat: {row: ['d', 'e', 'f']},\n        spec: specification,\n        resolve,\n        config\n      };\n  }\n\n  return null;\n}\n\nexport function unitNameRegex(specType: ComposeType, idx: number) {\n  const name = UNIT_NAMES[specType][idx].replace('child_', '');\n  return new RegExp(`child(.*?)_${name}`);\n}\n\nexport function parentSelector(compositeType: ComposeType, index: number) {\n  return compositeType === 'facet' ? `cell > g:nth-child(${index + 1})` : UNIT_NAMES.repeat[index] + '_group';\n}\n\nexport function brush(key: string, idx: number, parent?: string, targetBrush?: boolean) {\n  const fn = key.match('_clear') ? 'clear' : 'brush';\n  return `${fn}(${hits.interval[key][idx].join(', ')}, ${stringValue(parent)}, ${!!targetBrush})`;\n}\n\nexport function pt(key: string, idx: number, parent?: string) {\n  const fn = key.match('_clear') ? 'clear' : 'pt';\n  return `${fn}(${hits.discrete[key][idx]}, ${stringValue(parent)})`;\n}\n\nexport function embedFn(page: Page) {\n  return async (specification: TopLevelSpec) => {\n    await page.evaluate(\n      (_: any) => window['embed'](_),\n      // specification is serializable even if the types don't agree\n      specification as any\n    );\n  };\n}\n\nexport async function svg(page: Page, path: string, filename: string) {\n  const svgString = await page.evaluate(\n    `new Promise((resolve, reject) => { vega.resetSVGClipId(); view.runAsync().then(view => view.toSVG().then(resolve)) })`\n  );\n\n  if (generate) {\n    mkdirp((path = `${output}/${path}`));\n    fs.writeFileSync(`${path}/${filename}.svg`, svgString);\n  }\n\n  return svgString;\n}\n\nexport function testRenderFn(page: Page, path: string) {\n  return async (filename: string) => {\n    const render = await svg(page, path, filename);\n    const file = fs.readFileSync(`${output}/${path}/${filename}.svg`);\n    expect(render).toBe(file.toString());\n  };\n}\n"]}