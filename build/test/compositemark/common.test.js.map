{"version":3,"file":"common.test.js","sourceRoot":"","sources":["../../../test/compositemark/common.test.ts"],"names":[],"mappings":"AAAA,8BAA8B;AAC9B,OAAO,EAAC,SAAS,EAAU,MAAM,gBAAgB,CAAC;AAClD,OAAO,EAAC,SAAS,EAAC,MAAM,2BAA2B,CAAC;AACpD,OAAO,EAAC,WAAW,EAAE,UAAU,EAAC,MAAM,gBAAgB,CAAC;AACvD,OAAO,EAAC,WAAW,EAAC,MAAM,qBAAqB,CAAC;AAChD,OAAO,EAAC,aAAa,EAAC,MAAM,oBAAoB,CAAC;AAEjD,QAAQ,CAAC,mCAAmC,EAAE,GAAG,EAAE;IACjD,EAAE,CAAC,2EAA2E,EAAE,GAAG,EAAE;QACnF,MAAM,UAAU,GAAG,SAAS,CAC1B;YACE,IAAI,EAAE,EAAC,GAAG,EAAE,kBAAkB,EAAC;YAC/B,IAAI,EAAE,EAAC,IAAI,EAAE,UAAU,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAC;YAChD,QAAQ,EAAE,EAAC,CAAC,EAAE,EAAC,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,cAAc,EAAC,EAAC;SACtD,EACD,aAAa,CACd,CAAC;QAEF,MAAM,KAAK,GAAG,WAAW,CAAC,UAAU,CAAC,IAAI,UAAU,CAAC,KAAK,CAAC;QAC1D,MAAM,CAAC,KAAK,CAAC,CAAC,UAAU,EAAE,CAAC;QAC3B,KAAK,MAAM,QAAQ,IAAI,KAAK,EAAE;YAC5B,MAAM,OAAO,GAAY,UAAU,CAAC,QAAQ,CAAC,IAAI,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,QAAQ,CAAC,IAAI,CAAC;YAC3F,MAAM,CAAC,OAAO,CAAC,CAAC,UAAU,EAAE,CAAC;YAC7B,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACjC;IACH,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,0FAA0F,EAAE,GAAG,EAAE;QAClG,MAAM,UAAU,GAAG,SAAS,CAC1B;YACE,IAAI,EAAE,EAAC,GAAG,EAAE,kBAAkB,EAAC;YAC/B,IAAI,EAAE,UAAU;YAChB,QAAQ,EAAE,EAAC,CAAC,EAAE,EAAC,KAAK,EAAE,yBAAyB,EAAE,IAAI,EAAE,cAAc,EAAC,EAAC;SACxE,EACD,aAAa,CACd,CAAC;QAEF,MAAM,UAAU,GAAG,UAAU,CAAC,SAAS,CAAC;QACxC,MAAM,CAAC,UAAU,CAAC,CAAC,UAAU,EAAE,CAAC;QAEhC,MAAM,cAAc,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;QACrC,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,IAAI,cAAc,CAAC,SAAS,CAAC,CAAC,OAAO,CACrE,mFAAmF,CACpF,CAAC;QAEF,MAAM,cAAc,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;QACrC,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,IAAI,cAAc,CAAC,SAAS,CAAC,CAAC,OAAO,CACrE,mFAAmF,CACpF,CAAC;IACJ,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["/* tslint:disable:quotemark */\nimport {isMarkDef, MarkDef} from '../../src/mark';\nimport {normalize} from '../../src/normalize/index';\nimport {isLayerSpec, isUnitSpec} from '../../src/spec';\nimport {isCalculate} from '../../src/transform';\nimport {defaultConfig} from '.././../src/config';\n\ndescribe('common feature of composite marks', () => {\n  it('should clip all the part when clip property in composite mark def is true', () => {\n    const outputSpec = normalize(\n      {\n        data: {url: 'data/barley.json'},\n        mark: {type: 'errorbar', tick: true, clip: true},\n        encoding: {x: {field: 'yield', type: 'quantitative'}}\n      },\n      defaultConfig\n    );\n\n    const layer = isLayerSpec(outputSpec) && outputSpec.layer;\n    expect(layer).toBeTruthy();\n    for (const unitSpec of layer) {\n      const markDef: MarkDef = isUnitSpec(unitSpec) && isMarkDef(unitSpec.mark) && unitSpec.mark;\n      expect(markDef).toBeTruthy();\n      expect(markDef.clip).toBe(true);\n    }\n  });\n\n  it('should produce correct calculate transform when field name contains space or punctuation', () => {\n    const outputSpec = normalize(\n      {\n        data: {url: 'data/barley.json'},\n        mark: 'errorbar',\n        encoding: {x: {field: 'yield space,punctuation', type: 'quantitative'}}\n      },\n      defaultConfig\n    );\n\n    const transforms = outputSpec.transform;\n    expect(transforms).toBeTruthy();\n\n    const upperCalculate = transforms[1];\n    expect(isCalculate(upperCalculate) && upperCalculate.calculate).toEqual(\n      'datum[\"center_yield space,punctuation\"] + datum[\"extent_yield space,punctuation\"]'\n    );\n\n    const lowerCalculate = transforms[2];\n    expect(isCalculate(lowerCalculate) && lowerCalculate.calculate).toEqual(\n      'datum[\"center_yield space,punctuation\"] - datum[\"extent_yield space,punctuation\"]'\n    );\n  });\n});\n"]}