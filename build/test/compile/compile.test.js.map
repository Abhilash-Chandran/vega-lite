{"version":3,"file":"compile.test.js","sourceRoot":"","sources":["../../../test/compile/compile.test.ts"],"names":[],"mappings":"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","sourcesContent":["/* tslint:disable:quotemark */\n\nimport {compile} from '../../src/compile/compile';\nimport * as log from '../../src/log';\n\ndescribe('compile/compile', () => {\n  it('should throw error for invalid spec', () => {\n    expect(() => {\n      compile({} as any);\n    }).toThrow();\n  });\n\n  it('should return a spec with default top-level properties, size signals, data, marks, and title', () => {\n    const spec = compile({\n      data: {\n        values: [{a: 'A', b: 28}]\n      },\n      title: {text: 'test'},\n      mark: 'point',\n      encoding: {}\n    }).spec;\n\n    expect(spec.padding).toEqual(5);\n    expect(spec.autosize).toEqual('pad');\n    expect(spec.width).toEqual(20);\n    expect(spec.height).toEqual(20);\n    expect(spec.title).toEqual({text: 'test', frame: 'group'});\n\n    expect(spec.data.length).toEqual(1); // just source\n    expect(spec.marks.length).toEqual(1); // just the root group\n  });\n\n  it('should return a spec with specified top-level properties, size signals, data and marks', () => {\n    const spec = compile({\n      padding: 123,\n      data: {\n        values: [{a: 'A', b: 28}]\n      },\n      mark: 'point',\n      encoding: {}\n    }).spec;\n\n    expect(spec.padding).toEqual(123);\n    expect(spec.autosize).toEqual('pad');\n    expect(spec.width).toEqual(20);\n    expect(spec.height).toEqual(20);\n\n    expect(spec.data.length).toEqual(1); // just source.\n    expect(spec.marks.length).toEqual(1); // just the root group\n  });\n\n  it('should use size signal for bar chart width', () => {\n    const spec = compile({\n      data: {values: [{a: 'A', b: 28}]},\n      mark: 'bar',\n      encoding: {\n        x: {field: 'a', type: 'ordinal'},\n        y: {field: 'b', type: 'quantitative'}\n      }\n    }).spec;\n\n    expect(spec.signals).toEqual([\n      {\n        name: 'x_step',\n        value: 20\n      },\n      {\n        name: 'width',\n        update: `bandspace(domain('x').length, 0.1, 0.05) * x_step`\n      }\n    ]);\n    expect(spec.height).toEqual(200);\n  });\n\n  it('should set resize to true if requested', () => {\n    const spec = compile({\n      autosize: {\n        resize: true\n      },\n      data: {url: 'foo.csv'},\n      mark: 'point',\n      encoding: {}\n    }).spec;\n\n    expect((spec.autosize as any).resize).toBeTruthy();\n  });\n\n  it('should set autosize to fit and containment if requested', () => {\n    const spec = compile({\n      autosize: {\n        type: 'fit',\n        contains: 'content'\n      },\n      data: {url: 'foo.csv'},\n      mark: 'point',\n      encoding: {}\n    }).spec;\n\n    expect(spec.autosize).toEqual({type: 'fit', contains: 'content'});\n  });\n\n  it('should set autosize to fit if requested', () => {\n    const spec = compile({\n      autosize: 'fit',\n      data: {url: 'foo.csv'},\n      mark: 'point',\n      encoding: {}\n    }).spec;\n\n    expect(spec.autosize).toEqual('fit');\n  });\n\n  it(\n    'warn if size is data driven and autosize is fit',\n    log.wrap(localLogger => {\n      const spec = compile({\n        data: {values: [{a: 'A', b: 28}]},\n        mark: 'bar',\n        autosize: 'fit',\n        encoding: {\n          x: {field: 'a', type: 'ordinal'},\n          y: {field: 'b', type: 'quantitative'}\n        }\n      }).spec;\n      expect(localLogger.warns[0]).toEqual(log.message.CANNOT_FIX_RANGE_STEP_WITH_FIT);\n      expect(spec.width).toEqual(200);\n      expect(spec.height).toEqual(200);\n    })\n  );\n\n  it(\n    'warn if trying to fit composed spec',\n    log.wrap(localLogger => {\n      const spec = compile({\n        data: {values: [{a: 'A', b: 28}]},\n        autosize: 'fit',\n        vconcat: [\n          {\n            mark: 'point',\n            encoding: {}\n          }\n        ]\n      }).spec;\n      expect(localLogger.warns[0]).toEqual(log.message.FIT_NON_SINGLE);\n      expect(spec.autosize).toEqual('pad');\n    })\n  );\n\n  it('should return title for a layered spec.', () => {\n    const spec = compile({\n      data: {\n        values: [{a: 'A', b: 28}]\n      },\n      title: {text: 'test'},\n      layer: [\n        {\n          mark: 'point',\n          encoding: {}\n        }\n      ]\n    }).spec;\n    expect(spec.title).toEqual({text: 'test', frame: 'group'});\n  });\n\n  it('should return title (string) for a layered spec.', () => {\n    const spec = compile({\n      data: {\n        values: [{a: 'A', b: 28}]\n      },\n      title: 'test',\n      layer: [\n        {\n          mark: 'point',\n          encoding: {}\n        }\n      ]\n    }).spec;\n    expect(spec.title).toEqual({text: 'test', frame: 'group'});\n  });\n\n  it('should return title from a child of a layer spec if parent has no title.', () => {\n    const spec = compile({\n      data: {\n        values: [{a: 'A', b: 28}]\n      },\n      layer: [\n        {\n          title: {text: 'test'},\n          mark: 'point',\n          encoding: {}\n        }\n      ]\n    }).spec;\n    expect(spec.title).toEqual({text: 'test', frame: 'group'});\n  });\n\n  it('should return a title for a concat spec', () => {\n    const spec = compile({\n      data: {\n        values: [{a: 'A', b: 28}]\n      },\n      title: {text: 'test'},\n      hconcat: [\n        {\n          mark: 'point',\n          encoding: {}\n        }\n      ],\n      config: {title: {anchor: 'middle'}}\n    }).spec;\n    expect(spec.title).toEqual({\n      text: 'test',\n      anchor: 'middle' // We only support anchor as start for concat\n    });\n  });\n\n  it('should return a title for a concat spec, automatically set anchor to \"start\", and augment the title with non-mark title config (e.g., offset).', () => {\n    const spec = compile({\n      data: {\n        values: [{a: 'A', b: 28}]\n      },\n      title: {text: 'test'},\n      hconcat: [\n        {\n          mark: 'point',\n          encoding: {}\n        }\n      ],\n      config: {title: {offset: 5}}\n    }).spec;\n    expect(spec.title).toEqual({\n      text: 'test',\n      anchor: 'start',\n      offset: 5\n    });\n  });\n\n  it('should not have title if there is no title.', () => {\n    const spec = compile({\n      data: {\n        values: [{a: 'A', b: 28}]\n      },\n      hconcat: [\n        {\n          mark: 'point',\n          encoding: {}\n        }\n      ],\n      config: {title: {offset: 5}}\n    }).spec;\n    expect(spec.title).not.toBeDefined();\n  });\n\n  it('should use provided config.', () => {\n    const spec = compile(\n      {\n        mark: 'point',\n        data: {url: 'foo.csv'},\n        encoding: {}\n      },\n      {\n        config: {\n          background: 'blue'\n        }\n      }\n    ).spec;\n    expect(spec.config.background).toEqual('blue');\n  });\n\n  it('should merge spec and provided config.', () => {\n    const spec = compile(\n      {\n        mark: 'point',\n        data: {url: 'foo.csv'},\n        encoding: {},\n        config: {\n          background: 'red'\n        }\n      },\n      {\n        config: {\n          background: 'blue'\n        }\n      }\n    ).spec;\n    expect(spec.config.background).toEqual('red');\n  });\n\n  it('should return a spec with projections (implicit)', () => {\n    const spec = compile({\n      mark: 'geoshape',\n      data: {\n        url: 'data/us-10m.json',\n        format: {\n          type: 'topojson',\n          feature: 'states'\n        }\n      },\n      encoding: {}\n    }).spec;\n    expect(spec.projections).toBeDefined();\n  });\n\n  it('should return a spec with projections (explicit)', () => {\n    const spec = compile({\n      mark: 'geoshape',\n      projection: {\n        type: 'albersUsa'\n      },\n      data: {\n        url: 'data/us-10m.json',\n        format: {\n          type: 'topojson',\n          feature: 'states'\n        }\n      },\n      encoding: {}\n    }).spec;\n    expect(spec.projections).toBeDefined();\n  });\n});\n"]}