{"version":3,"file":"post.js","sourceRoot":"","sources":["../../../site/static/post.ts"],"names":[],"mappings":"AAAA,yEAAyE;AAIzE;;GAEG;AACH,MAAM,UAAU,IAAI,CAAC,MAAc,EAAE,GAAW,EAAE,IAAmE;IACnH,MAAM,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAChC,MAAM,IAAI,GAAG,KAAK,CAAC;IACnB,MAAM,IAAI,GAAG,GAAG,CAAC;IACjB,IAAI,KAAK,GAAG,CAAC,CAAC,CAAC,IAAI,GAAG,IAAI,CAAC,CAAC;IAE5B,SAAS,MAAM,CAAC,GAAiB;QAC/B,IAAI,GAAG,CAAC,MAAM,KAAK,MAAM,EAAE;YACzB,KAAK,GAAG,CAAC,CAAC;YACV,MAAM,CAAC,mBAAmB,CAAC,SAAS,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC;SACtD;IACH,CAAC;IACD,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC;IAElD,eAAe;IACf,oDAAoD;IACpD,SAAS,IAAI;QACX,IAAI,KAAK,IAAI,CAAC,EAAE;YACd,OAAO;SACR;QACD,MAAM,CAAC,WAAW,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;QAC9B,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QACvB,KAAK,IAAI,CAAC,CAAC;IACb,CAAC;IACD,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AACzB,CAAC","sourcesContent":["// copied from https://github.com/vega/vega-embed/blob/master/src/post.ts\n\nimport {Renderers} from 'vega';\n\n/**\n * Open editor url in a new window, and pass a message.\n */\nexport function post(window: Window, url: string, data: {config?: any; mode: any; renderer?: Renderers; spec: string}) {\n  const editor = window.open(url);\n  const wait = 10000;\n  const step = 250;\n  let count = ~~(wait / step);\n\n  function listen(evt: MessageEvent) {\n    if (evt.source === editor) {\n      count = 0;\n      window.removeEventListener('message', listen, false);\n    }\n  }\n  window.addEventListener('message', listen, false);\n\n  // send message\n  // periodically resend until ack received or timeout\n  function send() {\n    if (count <= 0) {\n      return;\n    }\n    editor.postMessage(data, '*');\n    setTimeout(send, step);\n    count -= 1;\n  }\n  setTimeout(send, step);\n}\n"]}