{"version":3,"file":"lookup.test.js","sourceRoot":"","sources":["../../../../test/compile/data/lookup.test.ts"],"names":[],"mappings":"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","sourcesContent":["import {assert} from 'chai';\nimport {AncestorParse} from '../../../src/compile/data';\nimport {LookupNode} from '../../../src/compile/data/lookup';\nimport {parseTransformArray} from '../../../src/compile/data/parse';\nimport * as log from '../../../src/log';\nimport {VgLookupTransform} from '../../../src/vega.schema';\nimport {parseUnitModel} from '../../util';\n\ndescribe('compile/data/lookup', () => {\n  it('should parse lookup from array', () => {\n    const model = parseUnitModel({\n      data: {url: 'data/lookup_groups.csv'},\n      transform: [\n        {\n          lookup: 'person',\n          from: {\n            data: {url: 'data/lookup_people.csv'},\n            key: 'name',\n            fields: ['age', 'height']\n          }\n        }\n      ],\n      mark: 'bar',\n      encoding: {}\n    });\n\n    const t = parseTransformArray(null, model, new AncestorParse());\n    assert.deepEqual<VgLookupTransform>((t as LookupNode).assemble(), {\n      type: 'lookup',\n      from: 'lookup_0',\n      key: 'name',\n      fields: ['person'],\n      values: ['age', 'height']\n    });\n  });\n\n  it('should create node for flat lookup', () => {\n    const lookup = new LookupNode(\n      null,\n      {\n        lookup: 'person',\n        from: {\n          data: {url: 'data/lookup_people.csv'},\n          key: 'name',\n          fields: ['age', 'height']\n        }\n      },\n      'lookup_0'\n    );\n\n    assert.deepEqual<VgLookupTransform>(lookup.assemble(), {\n      type: 'lookup',\n      from: 'lookup_0',\n      key: 'name',\n      fields: ['person'],\n      values: ['age', 'height']\n    });\n  });\n\n  it('should create node for nested lookup', () => {\n    const lookup = new LookupNode(\n      null,\n      {\n        lookup: 'person',\n        from: {\n          data: {url: 'data/lookup_people.csv'},\n          key: 'name'\n        },\n        as: 'foo'\n      },\n      'lookup_0'\n    );\n\n    assert.deepEqual<VgLookupTransform>(lookup.assemble(), {\n      type: 'lookup',\n      from: 'lookup_0',\n      key: 'name',\n      fields: ['person'],\n      as: ['foo']\n    });\n  });\n\n  it(\n    'should warn if fields are not specified and as is missing',\n    log.wrap(localLogger => {\n      const lookup = new LookupNode(\n        null,\n        {\n          lookup: 'person',\n          from: {\n            data: {url: 'data/lookup_people.csv'},\n            key: 'name'\n          }\n        },\n        'lookup_0'\n      );\n      lookup.assemble();\n\n      assert.equal(localLogger.warns[0], log.message.NO_FIELDS_NEEDS_AS);\n    })\n  );\n  it('should generate the correct hash', () => {\n    const lookup = new LookupNode(\n      null,\n      {\n        lookup: 'person',\n        from: {\n          data: {url: 'data/lookup_people.csv'},\n          key: 'name'\n        }\n      },\n      'lookup_0'\n    );\n    lookup.assemble();\n\n    assert.equal(lookup.hash(), 'Lookup -848385244');\n  });\n});\n"]}