{"version":3,"file":"nearest.test.js","sourceRoot":"","sources":["../../../../test/compile/selection/nearest.test.ts"],"names":[],"mappings":"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","sourcesContent":["/* tslint:disable quotemark */\n\nimport {assert} from 'chai';\nimport * as selection from '../../../src/compile/selection/selection';\nimport nearest from '../../../src/compile/selection/transforms/nearest';\nimport * as log from '../../../src/log';\nimport {duplicate} from '../../../src/util';\nimport {parseUnitModel} from '../../util';\n\nfunction getModel(markType: any) {\n  const model = parseUnitModel({\n    mark: markType,\n    encoding: {\n      x: {field: 'Horsepower', type: 'quantitative'},\n      y: {field: 'Miles_per_Gallon', type: 'quantitative'},\n      color: {field: 'Origin', type: 'nominal'}\n    }\n  });\n  model.parseScale();\n  model.parseMarkGroup();\n  model.component.selection = selection.parseUnitSelection(model, {\n    one: {type: 'single', nearest: true},\n    two: {type: 'multi', nearest: true},\n    three: {type: 'interval'},\n    four: {type: 'single', nearest: false},\n    five: {type: 'multi'},\n    six: {type: 'multi', nearest: null},\n    seven: {type: 'single', nearest: true, encodings: ['x']},\n    eight: {type: 'single', nearest: true, encodings: ['y']},\n    nine: {type: 'single', nearest: true, encodings: ['color']}\n  });\n\n  return model;\n}\n\nfunction voronoiMark(x?: string | {expr: string}, y?: string | {expr: string}) {\n  return [\n    {hello: 'world'},\n    {\n      name: 'voronoi',\n      type: 'path',\n      from: {data: 'marks'},\n      encode: {\n        enter: {\n          fill: {value: 'transparent'},\n          strokeWidth: {value: 0.35},\n          stroke: {value: 'transparent'},\n          isVoronoi: {value: true}\n        }\n      },\n      transform: [\n        {\n          type: 'voronoi',\n          x: x || {expr: 'datum.datum.x || 0'},\n          y: y || {expr: 'datum.datum.y || 0'},\n          size: [{signal: 'width'}, {signal: 'height'}]\n        }\n      ]\n    }\n  ];\n}\n\ndescribe('Nearest Selection Transform', () => {\n  it('identifies transform invocation', () => {\n    const selCmpts = getModel('circle').component.selection;\n    assert.isNotFalse(nearest.has(selCmpts['one']));\n    assert.isNotFalse(nearest.has(selCmpts['two']));\n    assert.isNotTrue(nearest.has(selCmpts['three']));\n    assert.isNotTrue(nearest.has(selCmpts['four']));\n    assert.isNotTrue(nearest.has(selCmpts['five']));\n    assert.isNotTrue(nearest.has(selCmpts['six']));\n  });\n\n  it('adds voronoi for non-path marks', () => {\n    const model = getModel('circle');\n    const selCmpts = model.component.selection;\n    const marks: any[] = [{hello: 'world'}];\n\n    assert.sameDeepMembers(nearest.marks(model, selCmpts['one'], marks), voronoiMark());\n  });\n\n  it(\n    'should warn for path marks',\n    log.wrap(localLogger => {\n      const model = getModel('line');\n      const selCmpts = model.component.selection;\n      const marks: any[] = [];\n      assert.equal(nearest.marks(model, selCmpts['one'], marks), marks);\n      assert.equal(localLogger.warns[0], log.message.nearestNotSupportForContinuous('line'));\n    })\n  );\n\n  it('limits to a single voronoi per unit', () => {\n    const model = getModel('circle');\n    const selCmpts = model.component.selection;\n    const marks: any[] = [{hello: 'world'}];\n\n    const marks2 = nearest.marks(model, selCmpts['one'], marks);\n    assert.sameDeepMembers(nearest.marks(model, selCmpts['two'], marks2), voronoiMark());\n  });\n\n  it('supports 1D voronoi', () => {\n    const model = getModel('circle');\n    const selCmpts = model.component.selection;\n    const marks: any[] = [{hello: 'world'}];\n\n    assert.sameDeepMembers(nearest.marks(model, selCmpts['seven'], duplicate(marks)), voronoiMark(null, {expr: '0'}));\n\n    assert.sameDeepMembers(nearest.marks(model, selCmpts['eight'], duplicate(marks)), voronoiMark({expr: '0'}));\n\n    assert.sameDeepMembers(nearest.marks(model, selCmpts['nine'], duplicate(marks)), voronoiMark());\n  });\n});\n"]}