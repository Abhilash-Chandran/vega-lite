{"version":3,"file":"toggle.test.js","sourceRoot":"","sources":["../../../../test/compile/selection/toggle.test.ts"],"names":[],"mappings":"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","sourcesContent":["/* tslint:disable quotemark */\n\nimport * as selection from '../../../src/compile/selection/selection';\nimport toggle from '../../../src/compile/selection/transforms/toggle';\nimport {parseUnitModel} from '../../util';\n\ndescribe('Toggle Selection Transform', () => {\n  const model = parseUnitModel({\n    mark: 'circle',\n    encoding: {\n      x: {field: 'Horsepower', type: 'quantitative'},\n      y: {field: 'Miles_per_Gallon', type: 'quantitative'},\n      color: {field: 'Origin', type: 'nominal'}\n    }\n  });\n\n  model.parseScale();\n  const selCmpts = (model.component.selection = selection.parseUnitSelection(model, {\n    one: {type: 'multi'},\n    two: {\n      type: 'multi',\n      resolve: 'union',\n      on: 'mouseover',\n      toggle: 'event.ctrlKey',\n      encodings: ['y', 'color']\n    },\n    three: {type: 'multi', toggle: false},\n    four: {type: 'multi', toggle: null},\n    five: {type: 'single'},\n    six: {type: 'interval'}\n  }));\n\n  it('identifies transform invocation', () => {\n    expect(toggle.has(selCmpts['one'])).toBeTruthy();\n    expect(toggle.has(selCmpts['two'])).toBeTruthy();\n    expect(toggle.has(selCmpts['three'])).toBeFalsy();\n    expect(toggle.has(selCmpts['four'])).toBeFalsy();\n    expect(toggle.has(selCmpts['five'])).toBeFalsy();\n    expect(toggle.has(selCmpts['six'])).toBeFalsy();\n  });\n\n  it('builds toggle signals', () => {\n    const oneSg = toggle.signals(model, selCmpts['one'], []);\n    expect(oneSg).toEqual([\n      {\n        name: 'one_toggle',\n        value: false,\n        on: [\n          {\n            events: selCmpts['one'].events,\n            update: 'event.shiftKey'\n          }\n        ]\n      }\n    ]);\n\n    const twoSg = toggle.signals(model, selCmpts['two'], []);\n    expect(twoSg).toEqual([\n      {\n        name: 'two_toggle',\n        value: false,\n        on: [\n          {\n            events: selCmpts['two'].events,\n            update: 'event.ctrlKey'\n          }\n        ]\n      }\n    ]);\n\n    const signals = selection.assembleUnitSelectionSignals(model, []);\n    expect(signals).toEqual(expect.arrayContaining([...oneSg, ...twoSg]));\n  });\n\n  it('builds modify expr', () => {\n    const oneExpr = toggle.modifyExpr(model, selCmpts['one'], '');\n    expect(oneExpr).toEqual('one_toggle ? null : one_tuple, one_toggle ? null : true, one_toggle ? one_tuple : null');\n\n    const twoExpr = toggle.modifyExpr(model, selCmpts['two'], '');\n    expect(twoExpr).toEqual(\n      'two_toggle ? null : two_tuple, two_toggle ? null : {unit: \"\"}, two_toggle ? two_tuple : null'\n    );\n\n    const signals = selection.assembleUnitSelectionSignals(model, []);\n    expect(signals).toEqual(\n      expect.arrayContaining([\n        {\n          name: 'one_modify',\n          update: `modify(\\\"one_store\\\", ${oneExpr})`\n        },\n        {\n          name: 'two_modify',\n          update: `modify(\\\"two_store\\\", ${twoExpr})`\n        }\n      ])\n    );\n  });\n});\n"]}