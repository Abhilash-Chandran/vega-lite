{"version":3,"file":"scales.test.js","sourceRoot":"","sources":["../../../../test/compile/selection/scales.test.ts"],"names":[],"mappings":"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","sourcesContent":["/* tslint:disable:quotemark */\n\nimport {X} from '../../../src/channel';\nimport {assembleScalesForModel} from '../../../src/compile/scale/assemble';\nimport {assembleTopLevelSignals, assembleUnitSelectionSignals} from '../../../src/compile/selection/selection';\nimport {UnitModel} from '../../../src/compile/unit';\nimport * as log from '../../../src/log';\nimport {Domain} from '../../../src/scale';\nimport {parseConcatModel, parseRepeatModel, parseUnitModelWithScale} from '../../util';\n\ndescribe('Selection + Scales', () => {\n  describe('domainRaw', () => {\n    it('is assembled from selection parameter', () => {\n      const model = parseConcatModel({\n        vconcat: [\n          {\n            mark: 'area',\n            selection: {\n              brush: {type: 'interval', encodings: ['x']},\n              brush2: {type: 'multi', fields: ['price'], resolve: 'intersect'}\n            },\n            encoding: {\n              x: {field: 'date', type: 'temporal'},\n              y: {field: 'price', type: 'quantitative'}\n            }\n          },\n          {\n            selection: {\n              brush3: {type: 'interval'}\n            },\n            mark: 'area',\n            encoding: {\n              x: {\n                field: 'date',\n                type: 'temporal',\n                scale: {domain: {selection: 'brush', encoding: 'x'}}\n              },\n              y: {\n                field: 'price',\n                type: 'quantitative',\n                scale: {domain: {selection: 'brush2', field: 'price'}}\n              },\n              color: {\n                field: 'symbol',\n                type: 'nominal',\n                scale: {domain: {selection: 'brush2'} as Domain}\n              },\n              opacity: {\n                field: 'symbol',\n                type: 'nominal',\n                scale: {domain: {selection: 'brush3'} as Domain}\n              }\n            }\n          }\n        ],\n        resolve: {\n          scale: {\n            color: 'independent',\n            opacity: 'independent'\n          }\n        }\n      });\n\n      model.parseScale();\n      model.parseSelection();\n\n      const scales = assembleScalesForModel(model.children[1]);\n      const xscale = scales[0];\n      const yscale = scales[1];\n      const cscale = scales[2];\n      const oscale = scales[3];\n\n      expect(typeof xscale.domain).toBe('object');\n      expect('domainRaw' in xscale).toBeTruthy();\n      expect(xscale.domainRaw.signal).toBe('brush[\"date\"]');\n\n      expect(typeof yscale.domain).toBe('object');\n      expect('domainRaw' in yscale).toBeTruthy();\n      expect(yscale.domainRaw.signal).toBe('brush2[\"price\"]');\n\n      expect(typeof cscale.domain).toBe('object');\n      expect('domainRaw' in cscale).toBeTruthy();\n      expect(cscale.domainRaw.signal).toBe('brush2[\"price\"]');\n\n      expect(typeof oscale.domain).toBe('object');\n      expect('domainRaw' in oscale).toBeTruthy();\n      expect(oscale.domainRaw.signal).toBe('null');\n    });\n\n    it('should bind both scales in diagonal repeated views', () => {\n      const model = parseRepeatModel({\n        repeat: {\n          row: ['Horsepower', 'Acceleration'],\n          column: ['Miles_per_Gallon', 'Acceleration']\n        },\n        spec: {\n          data: {url: 'data/cars.json'},\n          mark: 'point',\n          selection: {\n            grid: {\n              type: 'interval',\n              resolve: 'global',\n              bind: 'scales'\n            }\n          },\n          encoding: {\n            x: {field: {repeat: 'column'}, type: 'quantitative'},\n            y: {field: {repeat: 'row'}, type: 'quantitative'},\n            color: {field: 'Origin', type: 'nominal'}\n          }\n        }\n      });\n\n      model.parseScale();\n      model.parseSelection();\n\n      const scales = assembleScalesForModel(model.children[3]);\n      expect(scales.length === 2).toBe(true);\n      expect('domainRaw' in scales[0]).toBeTruthy();\n      expect('domainRaw' in scales[1]).toBeTruthy();\n      expect(scales[0].domainRaw.signal).toBe('grid[\"Acceleration\"]');\n      expect(scales[1].domainRaw.signal).toBe('grid[\"Acceleration\"]');\n    });\n\n    it('should be merged for layered views', () => {\n      const model = parseConcatModel({\n        data: {url: 'data/sp500.csv'},\n        vconcat: [\n          {\n            layer: [\n              {\n                mark: 'point',\n                encoding: {\n                  x: {\n                    field: 'date',\n                    type: 'temporal',\n                    scale: {domain: {selection: 'brush'}}\n                  },\n                  y: {field: 'price', type: 'quantitative'}\n                }\n              }\n            ]\n          },\n          {\n            mark: 'area',\n            selection: {\n              brush: {type: 'interval', encodings: ['x']}\n            },\n            encoding: {\n              x: {field: 'date', type: 'temporal'},\n              y: {field: 'price', type: 'quantitative'}\n            }\n          }\n        ]\n      });\n\n      model.parseScale();\n      model.parseSelection();\n      const scales = assembleScalesForModel(model.children[0]);\n      expect('domainRaw' in scales[0]).toBeTruthy();\n      expect(scales[0].domainRaw.signal).toBe('brush[\"date\"]');\n    });\n  });\n\n  describe('signals', () => {\n    const model = parseRepeatModel({\n      repeat: {\n        row: ['Horsepower', 'Acceleration'],\n        column: ['Miles_per_Gallon', 'Acceleration']\n      },\n      spec: {\n        data: {url: 'data/cars.json'},\n        mark: 'point',\n        selection: {\n          grid: {\n            type: 'interval',\n            resolve: 'global',\n            bind: 'scales'\n          }\n        },\n        encoding: {\n          x: {field: {repeat: 'column'}, type: 'quantitative'},\n          y: {field: {repeat: 'row'}, type: 'quantitative'},\n          color: {field: 'Origin', type: 'nominal'}\n        }\n      }\n    });\n\n    model.parseScale();\n    model.parseSelection();\n\n    it('should be marked as push: outer', () => {\n      const signals = assembleUnitSelectionSignals(model.children[0] as UnitModel, []);\n      const hp = signals.filter(s => s.name === 'grid_Horsepower');\n      const mpg = signals.filter(s => s.name === 'grid_Miles_per_Gallon');\n\n      expect(hp.length).toBe(1);\n      expect(hp[0].push).toBe('outer');\n      expect('value' in hp[0]).toBeFalsy();\n      expect('update' in hp[0]).toBeFalsy();\n\n      expect(mpg.length).toBe(1);\n      expect(mpg[0].push).toBe('outer');\n      expect('value' in mpg[0]).toBeFalsy();\n      expect('update' in mpg[0]).toBeFalsy();\n    });\n\n    it('should be assembled at the top-level', () => {\n      const signals = assembleTopLevelSignals(model.children[0] as UnitModel, []);\n      const hp = signals.filter(s => s.name === 'grid_Horsepower');\n      const mpg = signals.filter(s => s.name === 'grid_Miles_per_Gallon');\n      let named = signals.filter(s => s.name === 'grid');\n\n      expect(hp.length).toBe(1);\n      expect(mpg.length).toBe(1);\n      expect(named.length).toBe(1);\n      expect(named[0].update).toEqual('{\"Miles_per_Gallon\": grid_Miles_per_Gallon, \"Horsepower\": grid_Horsepower}');\n\n      const signals2 = assembleTopLevelSignals(model.children[1] as UnitModel, signals);\n      const acc = signals2.filter(s => s.name === 'grid_Acceleration');\n      named = signals2.filter(s => s.name === 'grid');\n\n      expect(acc.length).toBe(1);\n      expect(named.length).toBe(1);\n      expect(named[0].update).toEqual(\n        '{\"Miles_per_Gallon\": grid_Miles_per_Gallon, \"Horsepower\": grid_Horsepower, \"Acceleration\": grid_Acceleration}'\n      );\n    });\n  });\n\n  it(\n    'should not bind for unavailable/unsupported scales',\n    log.wrap(localLogger => {\n      let model = parseUnitModelWithScale({\n        data: {url: 'data/cars.json'},\n        selection: {\n          grid: {type: 'interval', bind: 'scales'}\n        },\n        mark: 'circle',\n        encoding: {\n          y: {field: 'Miles_per_Gallon', type: 'quantitative'}\n        }\n      });\n      model.parseSelection();\n      expect(localLogger.warns[0]).toEqual(log.message.cannotProjectOnChannelWithoutField(X));\n\n      model = parseUnitModelWithScale({\n        data: {url: 'data/cars.json'},\n        selection: {\n          grid: {type: 'interval', bind: 'scales'}\n        },\n        mark: 'circle',\n        encoding: {\n          x: {field: 'Origin', type: 'nominal'},\n          y: {field: 'Miles_per_Gallon', type: 'quantitative'}\n        }\n      });\n      model.parseSelection();\n      expect(localLogger.warns[1]).toEqual(log.message.SCALE_BINDINGS_CONTINUOUS);\n    })\n  );\n});\n"]}