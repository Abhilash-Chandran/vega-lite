{"version":3,"file":"parse.test.js","sourceRoot":"","sources":["../../../../test/compile/projection/parse.test.ts"],"names":[],"mappings":"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","sourcesContent":["import {parseLayerModel, parseUnitModelWithScaleAndLayoutSize} from '../../util';\n/* tslint:disable:quotemark */\n\ndescribe('src/compile/projection/parse', () => {\n  describe('parseUnitProjection', () => {\n    it('should create projection from specified projection', () => {\n      const model = parseUnitModelWithScaleAndLayoutSize({\n        mark: 'geoshape',\n        projection: {\n          type: 'albersUsa'\n        },\n        data: {\n          url: 'data/us-10m.json',\n          format: {\n            type: 'topojson',\n            feature: 'states'\n          }\n        },\n        encoding: {}\n      });\n      model.parse();\n      expect(model.component.projection.explicit).toEqual({type: 'albersUsa'});\n    });\n\n    it('should create projection with no props', () => {\n      const model = parseUnitModelWithScaleAndLayoutSize({\n        mark: 'geoshape',\n        data: {\n          url: 'data/us-10m.json',\n          format: {\n            type: 'topojson',\n            feature: 'states'\n          }\n        },\n        encoding: {}\n      });\n      model.parse();\n      expect(model.component.projection.explicit).toEqual({});\n    });\n\n    it('should create projection from config', () => {\n      const model = parseUnitModelWithScaleAndLayoutSize({\n        mark: 'geoshape',\n        data: {\n          url: 'data/us-10m.json',\n          format: {\n            type: 'topojson',\n            feature: 'states'\n          }\n        },\n        encoding: {},\n        config: {\n          projection: {\n            type: 'albersUsa'\n          }\n        }\n      });\n      model.parse();\n      expect(model.component.projection.explicit).toEqual({type: 'albersUsa'});\n    });\n\n    it('should add data with signal', () => {\n      const model = parseUnitModelWithScaleAndLayoutSize({\n        data: {\n          url: 'data/airports.csv',\n          format: {\n            type: 'csv'\n          }\n        },\n        mark: 'circle',\n        projection: {\n          type: 'albersUsa'\n        },\n        encoding: {\n          longitude: {\n            field: 'longitude',\n            type: 'quantitative'\n          },\n          latitude: {\n            field: 'latitude',\n            type: 'quantitative'\n          }\n        }\n      });\n      model.parse();\n      expect(typeof model.component.projection.data[0]).toBe('object');\n      expect(model.component.projection.data[0]).toHaveProperty('signal');\n    });\n\n    it('should add data from main', () => {\n      const model = parseUnitModelWithScaleAndLayoutSize({\n        mark: 'geoshape',\n        data: {\n          url: 'data/us-10m.json',\n          format: {\n            type: 'topojson',\n            feature: 'states'\n          }\n        },\n        encoding: {}\n      });\n      model.parse();\n      expect(typeof model.component.projection.data[0]).toBe('string');\n      expect(typeof model.component.projection.data[0]).not.toBe('object');\n      expect(model.component.projection.data[0]).not.toHaveProperty('signal');\n    });\n  });\n\n  describe('parseNonUnitProjection', () => {\n    it('should merge the same projection', () => {\n      const model = parseLayerModel({\n        layer: [\n          {\n            mark: 'geoshape',\n            projection: {\n              type: 'albersUsa'\n            },\n            data: {\n              url: 'data/us-10m.json',\n              format: {\n                type: 'topojson',\n                feature: 'states'\n              }\n            },\n            encoding: {}\n          },\n          {\n            data: {\n              url: 'data/airports.csv'\n            },\n            mark: 'circle',\n            projection: {\n              type: 'albersUsa'\n            },\n            encoding: {\n              longitude: {\n                field: 'longitude',\n                type: 'quantitative'\n              },\n              latitude: {\n                field: 'latitude',\n                type: 'quantitative'\n              }\n            }\n          }\n        ]\n      });\n      model.parse();\n      expect(model.component.projection.explicit).toEqual({type: 'albersUsa'});\n    });\n\n    it('should merge in empty projection to specified projection', () => {\n      const emptyFirst = parseLayerModel({\n        layer: [\n          {\n            mark: 'geoshape',\n            data: {\n              url: 'data/us-10m.json',\n              format: {\n                type: 'topojson',\n                feature: 'states'\n              }\n            },\n            encoding: {}\n          },\n          {\n            data: {\n              url: 'data/airports.csv'\n            },\n            mark: 'circle',\n            projection: {\n              type: 'albersUsa'\n            },\n            encoding: {\n              longitude: {\n                field: 'longitude',\n                type: 'quantitative'\n              },\n              latitude: {\n                field: 'latitude',\n                type: 'quantitative'\n              }\n            }\n          }\n        ]\n      });\n      emptyFirst.parse();\n      expect(emptyFirst.component.projection.explicit).toEqual({type: 'albersUsa'});\n      const emptyLast = parseLayerModel({\n        layer: [\n          {\n            mark: 'geoshape',\n            data: {\n              url: 'data/us-10m.json',\n              format: {\n                type: 'topojson',\n                feature: 'states'\n              }\n            },\n            encoding: {}\n          },\n          {\n            data: {\n              url: 'data/airports.csv'\n            },\n            mark: 'circle',\n            projection: {\n              type: 'albersUsa'\n            },\n            encoding: {\n              longitude: {\n                field: 'longitude',\n                type: 'quantitative'\n              },\n              latitude: {\n                field: 'latitude',\n                type: 'quantitative'\n              }\n            }\n          }\n        ]\n      });\n      emptyLast.parse();\n      expect(emptyLast.component.projection.explicit).toEqual({type: 'albersUsa'});\n    });\n\n    it('should merge projections with same size, different data', () => {\n      const model = parseLayerModel({\n        layer: [\n          {\n            mark: 'geoshape',\n            projection: {\n              type: 'albersUsa'\n            },\n            data: {\n              url: 'data/us-10m.json',\n              format: {\n                type: 'topojson',\n                feature: 'states'\n              }\n            },\n            encoding: {}\n          },\n          {\n            data: {\n              url: 'data/airports.csv'\n            },\n            mark: 'circle',\n            projection: {\n              type: 'albersUsa'\n            },\n            encoding: {\n              longitude: {\n                field: 'longitude',\n                type: 'quantitative'\n              },\n              latitude: {\n                field: 'latitude',\n                type: 'quantitative'\n              }\n            }\n          }\n        ]\n      });\n      model.parse();\n      expect(model.component.projection.explicit).toEqual({type: 'albersUsa'});\n    });\n\n    it('should not merge different specified projections', () => {\n      const model = parseLayerModel({\n        layer: [\n          {\n            mark: 'geoshape',\n            projection: {\n              type: 'mercator'\n            },\n            data: {\n              url: 'data/us-10m.json',\n              format: {\n                type: 'topojson',\n                feature: 'states'\n              }\n            },\n            encoding: {}\n          },\n          {\n            data: {\n              url: 'data/airports.csv'\n            },\n            mark: 'circle',\n            projection: {\n              type: 'albersUsa'\n            },\n            encoding: {\n              longitude: {\n                field: 'longitude',\n                type: 'quantitative'\n              },\n              latitude: {\n                field: 'latitude',\n                type: 'quantitative'\n              }\n            }\n          }\n        ]\n      });\n      model.parse();\n      expect(model.component.projection).toBeUndefined();\n    });\n  });\n});\n"]}