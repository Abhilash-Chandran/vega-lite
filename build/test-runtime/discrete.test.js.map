{"version":3,"file":"discrete.test.js","sourceRoot":"","sources":["../../test-runtime/discrete.test.ts"],"names":[],"mappings":"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","sourcesContent":["import {assert} from 'chai';\nimport {embedFn, hits as hitsMaster, pt, spec, testRenderFn} from './util';\n\n['single', 'multi'].forEach(type => {\n  describe(`${type} selections at runtime in unit views`, () => {\n    const hits = hitsMaster.discrete;\n    const embed = embedFn(browser);\n    const testRender = testRenderFn(browser, `${type}/unit`);\n\n    it('should add values to the store', () => {\n      for (let i = 0; i < hits.qq.length; i++) {\n        embed(spec('unit', i, {type}));\n        const store = browser.execute(pt('qq', i)).value;\n        assert.lengthOf(store, 1);\n        assert.lengthOf(store[0].encodings, 0);\n        assert.lengthOf(store[0].fields, 1);\n        assert.lengthOf(store[0].values, 1);\n        testRender(`click_${i}`);\n      }\n    });\n\n    it('should respect projections', () => {\n      let values: number[][] = [];\n      let encodings: string[] = [];\n      let fields: string[] = [];\n      const test = (emb: (i: number) => void) => {\n        for (let i = 0; i < hits.qq.length; i++) {\n          emb(i);\n          const store = browser.execute(pt('qq', i)).value;\n          assert.lengthOf(store, 1);\n          assert.deepEqual(store[0].encodings, encodings);\n          assert.deepEqual(store[0].fields, fields);\n          assert.deepEqual(store[0].values, values[i]);\n          testRender(`${encodings}_${fields}_${i}`);\n        }\n      };\n\n      encodings = ['x', 'color'];\n      fields = ['a', 'c'];\n      values = [[2, 1], [6, 0]];\n      test((i: number) => embed(spec('unit', i, {type, encodings})));\n\n      encodings = [];\n      fields = ['c', 'a', 'b'];\n      values = [[1, 2, 53], [0, 6, 87]];\n      test((i: number) => embed(spec('unit', i, {type, fields})));\n    });\n\n    it('should clear out the store', () => {\n      for (let i = 0; i < hits.qq_clear.length; i++) {\n        embed(spec('unit', i, {type}));\n        let store = browser.execute(pt('qq', i)).value;\n        assert.lengthOf(store, 1);\n\n        store = browser.execute(pt('qq_clear', i)).value;\n        assert.lengthOf(store, 0);\n        testRender(`clear_${i}`);\n      }\n    });\n\n    it('should support selecting bins', () => {\n      const encodings = ['x', 'color', 'y'];\n      const fields = ['a', 'c', 'b'];\n      const values = [[[1, 2], 0, [40, 50]], [[8, 9], 1, [10, 20]]];\n\n      for (let i = 0; i < hits.bins.length; i++) {\n        embed(spec('unit', i, {type, encodings}, {x: {bin: true}, y: {bin: true}}));\n        const store = browser.execute(pt('bins', i)).value;\n        assert.lengthOf(store, 1);\n        assert.sameMembers(store[0].encodings, encodings);\n        assert.sameMembers(store[0].fields, fields);\n        assert.sameDeepMembers(store[0].values, values[i]);\n        assert.property(store[0], 'bin_a');\n        assert.property(store[0], 'bin_b');\n        assert.notProperty(store[0], 'bin_c');\n        testRender(`bins_${i}`);\n      }\n    });\n  });\n});\n"]}