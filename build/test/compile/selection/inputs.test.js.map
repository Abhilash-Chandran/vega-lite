{"version":3,"file":"inputs.test.js","sourceRoot":"","sources":["../../../../test/compile/selection/inputs.test.ts"],"names":[],"mappings":"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","sourcesContent":["/* tslint:disable quotemark */\n\nimport {assert} from 'chai';\nimport * as selection from '../../../src/compile/selection/selection';\nimport inputs from '../../../src/compile/selection/transforms/inputs';\nimport {parseUnitModel} from '../../util';\n\ndescribe('Inputs Selection Transform', () => {\n  const model = parseUnitModel({\n    mark: 'circle',\n    encoding: {\n      x: {field: 'Horsepower', type: 'quantitative'},\n      y: {field: 'Miles_per_Gallon', type: 'quantitative'},\n      color: {field: 'Origin', type: 'nominal'}\n    }\n  });\n\n  model.parseScale();\n  const selCmpts = selection.parseUnitSelection(model, {\n    one: {\n      type: 'single',\n      bind: {input: 'range', min: 0, max: 10, step: 1}\n    },\n    two: {\n      type: 'single',\n      fields: ['Cylinders', 'Horsepower'],\n      bind: {input: 'range', min: 0, max: 10, step: 1}\n    },\n    three: {\n      type: 'single',\n      nearest: true,\n      fields: ['Cylinders', 'Origin'],\n      bind: {\n        Horsepower: {input: 'range', min: 0, max: 10, step: 1},\n        Origin: {input: 'select', options: ['Japan', 'USA', 'Europe']}\n      }\n    },\n    four: {\n      type: 'single',\n      bind: null\n    },\n    six: {\n      type: 'interval',\n      bind: 'scales'\n    }\n  });\n\n  it('identifies transform invocation', () => {\n    assert.isNotFalse(inputs.has(selCmpts['one']));\n    assert.isNotFalse(inputs.has(selCmpts['two']));\n    assert.isNotFalse(inputs.has(selCmpts['three']));\n    assert.isNotTrue(inputs.has(selCmpts['four']));\n    assert.isNotTrue(inputs.has(selCmpts['six']));\n  });\n\n  it('adds widget binding for default projection', () => {\n    model.component.selection = {one: selCmpts['one']};\n    assert.includeDeepMembers(selection.assembleUnitSelectionSignals(model, []), [\n      {\n        name: 'one_tuple',\n        update: 'one__vgsid_ ? {fields: [\"_vgsid_\"], values: [one__vgsid_]} : null'\n      }\n    ]);\n\n    assert.includeDeepMembers(selection.assembleTopLevelSignals(model, []), [\n      {\n        name: 'one__vgsid_',\n        value: '',\n        on: [\n          {\n            events: [{source: 'scope', type: 'click'}],\n            update: 'datum && item().mark.marktype !== \\'group\\' ? datum[\"_vgsid_\"] : null'\n          }\n        ],\n        bind: {input: 'range', min: 0, max: 10, step: 1}\n      }\n    ]);\n  });\n\n  it('adds single widget binding for compound projection', () => {\n    model.component.selection = {two: selCmpts['two']};\n    assert.includeDeepMembers(selection.assembleUnitSelectionSignals(model, []), [\n      {\n        name: 'two_tuple',\n        update:\n          'two_Cylinders && two_Horsepower ? {fields: [\"Cylinders\", \"Horsepower\"], values: [two_Cylinders, two_Horsepower]} : null'\n      }\n    ]);\n\n    assert.includeDeepMembers(selection.assembleTopLevelSignals(model, []), [\n      {\n        name: 'two_Horsepower',\n        value: '',\n        on: [\n          {\n            events: [{source: 'scope', type: 'click'}],\n            update: 'datum && item().mark.marktype !== \\'group\\' ? datum[\"Horsepower\"] : null'\n          }\n        ],\n        bind: {input: 'range', min: 0, max: 10, step: 1}\n      },\n      {\n        name: 'two_Cylinders',\n        value: '',\n        on: [\n          {\n            events: [{source: 'scope', type: 'click'}],\n            update: 'datum && item().mark.marktype !== \\'group\\' ? datum[\"Cylinders\"] : null'\n          }\n        ],\n        bind: {input: 'range', min: 0, max: 10, step: 1}\n      }\n    ]);\n  });\n\n  it('adds projection-specific widget bindings', () => {\n    model.component.selection = {three: selCmpts['three']};\n    assert.includeDeepMembers(selection.assembleUnitSelectionSignals(model, []), [\n      {\n        name: 'three_tuple',\n        update:\n          'three_Cylinders && three_Origin ? {fields: [\"Cylinders\", \"Origin\"], values: [three_Cylinders, three_Origin]} : null'\n      }\n    ]);\n\n    assert.includeDeepMembers(selection.assembleTopLevelSignals(model, []), [\n      {\n        name: 'three_Origin',\n        value: '',\n        on: [\n          {\n            events: [{source: 'scope', type: 'click'}],\n            update:\n              'datum && item().mark.marktype !== \\'group\\' ? (item().isVoronoi ? datum.datum : datum)[\"Origin\"] : null'\n          }\n        ],\n        bind: {\n          input: 'select',\n          options: ['Japan', 'USA', 'Europe']\n        }\n      },\n      {\n        name: 'three_Cylinders',\n        value: '',\n        on: [\n          {\n            events: [{source: 'scope', type: 'click'}],\n            update:\n              'datum && item().mark.marktype !== \\'group\\' ? (item().isVoronoi ? datum.datum : datum)[\"Cylinders\"] : null'\n          }\n        ],\n        bind: {\n          Horsepower: {input: 'range', min: 0, max: 10, step: 1},\n          Origin: {\n            input: 'select',\n            options: ['Japan', 'USA', 'Europe']\n          }\n        }\n      }\n    ]);\n  });\n});\n"]}