{"version":3,"file":"single.test.js","sourceRoot":"","sources":["../../../../test/compile/selection/single.test.ts"],"names":[],"mappings":"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","sourcesContent":["/* tslint:disable quotemark */\nimport * as selection from '../../../src/compile/selection/selection';\nimport single from '../../../src/compile/selection/single';\nimport {parseUnitModelWithScale} from '../../util';\n\ndescribe('Single Selection', () => {\n  const model = parseUnitModelWithScale({\n    mark: 'circle',\n    encoding: {\n      x: {field: 'Horsepower', type: 'quantitative'},\n      y: {field: 'Miles_per_Gallon', type: 'quantitative', bin: true},\n      color: {field: 'Origin', type: 'nominal'}\n    }\n  });\n\n  model.parseScale();\n\n  const selCmpts = (model.component.selection = selection.parseUnitSelection(model, {\n    one: {type: 'single'},\n    two: {\n      type: 'single',\n      nearest: true,\n      on: 'mouseover',\n      encodings: ['y', 'color'],\n      resolve: 'intersect'\n    }\n  }));\n\n  it('builds tuple signals', () => {\n    const oneSg = single.signals(model, selCmpts['one']);\n    expect(oneSg).toEqual([\n      {\n        name: 'one_tuple',\n        value: {},\n        on: [\n          {\n            events: selCmpts['one'].events,\n            update:\n              'datum && item().mark.marktype !== \\'group\\' ? {unit: \"\", fields: one_tuple_fields, values: [(item().isVoronoi ? datum.datum : datum)[\"_vgsid_\"]]} : null',\n            force: true\n          }\n        ]\n      }\n    ]);\n\n    const twoSg = single.signals(model, selCmpts['two']);\n    expect(twoSg).toEqual([\n      {\n        name: 'two_tuple',\n        value: {},\n        on: [\n          {\n            events: selCmpts['two'].events,\n            update:\n              'datum && item().mark.marktype !== \\'group\\' ? {unit: \"\", fields: two_tuple_fields, values: [[(item().isVoronoi ? datum.datum : datum)[\"bin_maxbins_10_Miles_per_Gallon\"], (item().isVoronoi ? datum.datum : datum)[\"bin_maxbins_10_Miles_per_Gallon_end\"]], (item().isVoronoi ? datum.datum : datum)[\"Origin\"]]} : null',\n            force: true\n          }\n        ]\n      }\n    ]);\n\n    const signals = selection.assembleUnitSelectionSignals(model, []);\n    expect(signals).toEqual(expect.arrayContaining(oneSg.concat(twoSg)));\n  });\n\n  it('builds modify signals', () => {\n    const oneExpr = single.modifyExpr(model, selCmpts['one']);\n    expect(oneExpr).toEqual('one_tuple, true');\n\n    const twoExpr = single.modifyExpr(model, selCmpts['two']);\n    expect(twoExpr).toEqual('two_tuple, {unit: \"\"}');\n\n    const signals = selection.assembleUnitSelectionSignals(model, []);\n    expect(signals).toEqual(\n      expect.arrayContaining([\n        {\n          name: 'one_modify',\n          on: [\n            {\n              events: {signal: 'one_tuple'},\n              update: `modify(\\\"one_store\\\", ${oneExpr})`\n            }\n          ]\n        },\n        {\n          name: 'two_modify',\n          on: [\n            {\n              events: {signal: 'two_tuple'},\n              update: `modify(\\\"two_store\\\", ${twoExpr})`\n            }\n          ]\n        }\n      ])\n    );\n  });\n\n  it('builds top-level signals', () => {\n    const signals = selection.assembleTopLevelSignals(model, []);\n    expect(signals).toEqual(\n      expect.arrayContaining([\n        {\n          name: 'one',\n          update: 'vlSelectionResolve(\"one_store\")'\n        },\n        {\n          name: 'two',\n          update: 'vlSelectionResolve(\"two_store\", \"intersect\")'\n        },\n        {\n          name: 'unit',\n          value: {},\n          on: [{events: 'mousemove', update: 'isTuple(group()) ? group() : unit'}]\n        }\n      ])\n    );\n  });\n\n  it('builds unit datasets', () => {\n    const data: any[] = [];\n    expect(selection.assembleUnitSelectionData(model, data)).toEqual([{name: 'one_store'}, {name: 'two_store'}]);\n  });\n\n  it('leaves marks alone', () => {\n    const marks: any[] = [];\n    model.component.selection = {one: selCmpts['one']};\n    expect(selection.assembleUnitSelectionMarks(model, marks)).toEqual(marks);\n  });\n});\n"]}