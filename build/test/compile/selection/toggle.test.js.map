{"version":3,"file":"toggle.test.js","sourceRoot":"","sources":["../../../../test/compile/selection/toggle.test.ts"],"names":[],"mappings":"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","sourcesContent":["/* tslint:disable quotemark */\n\nimport {assert} from 'chai';\nimport * as selection from '../../../src/compile/selection/selection';\nimport toggle from '../../../src/compile/selection/transforms/toggle';\nimport {parseUnitModel} from '../../util';\n\ndescribe('Toggle Selection Transform', () => {\n  const model = parseUnitModel({\n    mark: 'circle',\n    encoding: {\n      x: {field: 'Horsepower', type: 'quantitative'},\n      y: {field: 'Miles_per_Gallon', type: 'quantitative'},\n      color: {field: 'Origin', type: 'nominal'}\n    }\n  });\n\n  model.parseScale();\n  const selCmpts = (model.component.selection = selection.parseUnitSelection(model, {\n    one: {type: 'multi'},\n    two: {\n      type: 'multi',\n      resolve: 'union',\n      on: 'mouseover',\n      toggle: 'event.ctrlKey',\n      encodings: ['y', 'color']\n    },\n    three: {type: 'multi', toggle: false},\n    four: {type: 'multi', toggle: null},\n    five: {type: 'single'},\n    six: {type: 'interval'}\n  }));\n\n  it('identifies transform invocation', () => {\n    assert.isNotFalse(toggle.has(selCmpts['one']));\n    assert.isNotFalse(toggle.has(selCmpts['two']));\n    assert.isNotTrue(toggle.has(selCmpts['three']));\n    assert.isNotTrue(toggle.has(selCmpts['four']));\n    assert.isNotTrue(toggle.has(selCmpts['five']));\n    assert.isNotTrue(toggle.has(selCmpts['six']));\n  });\n\n  it('builds toggle signals', () => {\n    const oneSg = toggle.signals(model, selCmpts['one'], []);\n    assert.sameDeepMembers(oneSg, [\n      {\n        name: 'one_toggle',\n        value: false,\n        on: [\n          {\n            events: selCmpts['one'].events,\n            update: 'event.shiftKey'\n          }\n        ]\n      }\n    ]);\n\n    const twoSg = toggle.signals(model, selCmpts['two'], []);\n    assert.sameDeepMembers(twoSg, [\n      {\n        name: 'two_toggle',\n        value: false,\n        on: [\n          {\n            events: selCmpts['two'].events,\n            update: 'event.ctrlKey'\n          }\n        ]\n      }\n    ]);\n\n    const signals = selection.assembleUnitSelectionSignals(model, []);\n    assert.includeDeepMembers(signals, oneSg.concat(twoSg));\n  });\n\n  it('builds modify expr', () => {\n    const oneExpr = toggle.modifyExpr(model, selCmpts['one'], '');\n    assert.equal(oneExpr, 'one_toggle ? null : one_tuple, one_toggle ? null : true, one_toggle ? one_tuple : null');\n\n    const twoExpr = toggle.modifyExpr(model, selCmpts['two'], '');\n    assert.equal(\n      twoExpr,\n      'two_toggle ? null : two_tuple, two_toggle ? null : {unit: \"\"}, two_toggle ? two_tuple : null'\n    );\n\n    const signals = selection.assembleUnitSelectionSignals(model, []);\n    assert.includeDeepMembers(signals, [\n      {\n        name: 'one_modify',\n        on: [\n          {\n            events: {signal: 'one_tuple'},\n            update: `modify(\\\"one_store\\\", ${oneExpr})`\n          }\n        ]\n      },\n      {\n        name: 'two_modify',\n        on: [\n          {\n            events: {signal: 'two_tuple'},\n            update: `modify(\\\"two_store\\\", ${twoExpr})`\n          }\n        ]\n      }\n    ]);\n  });\n});\n"]}